language: cpp
cache: ccache

os: [linux, freebsd]
dist: focal
virt: lxd
group: edge

compiler: gcc
env: 
  - [CMAKE_BUILD_TYPE=Debug, CMAKE_BUILD_TYPE=Release]
  - CMAKE_UNITY_BUILD=ON
  - CMAKE_BUILD_PARALLEL_LEVEL=2 # Just make it 2, Travis always has two cores

branches:
  except:
    - /^dependabot\/.*$/

addons:
  apt:
    update: true
    packages: &required_packages
      - [libsdl2-dev libglew-dev liblzo2-dev libjpeg-dev libopenal-dev libogg-dev libtheora-dev libvorbis-dev]
  pkg:
    - [sdl2, glew, lzo2, jpeg-turbo, openal-soft, libogg, libtheora, libvorbis]

jobs:
  include:
    - arch: arm64-graviton2

before_script:
  - git submodule deinit Externals/cryptopp
  #- if [ $TRAVIS_OS_NAME == freebsd ]; then
  #
  #  fi
  
script:
- CFLAGS="-w" CXXFLAGS="-w" cmake -B build
- cmake --build build
- if [ $TRAVIS_OS_NAME == linux ]; then
      make -j $core_count package;
      file openxray_1.6.02_*.deb;
  fi

deploy:
  provider: releases
  token:
    secure: kGVniXDR926BfVcA97y25BzALbijvgboBsozZzY9yc8RPz15Q4YG474h7vl14/J1
  file: ./*.deb
  draft: true

notifications:
  email: false
