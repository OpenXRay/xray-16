language: cpp
cache: ccache

os: [linux, freebsd]
dist: focal
virt: lxd
group: edge

arch: [arm64-graviton2, ppc64le, s390x]

compiler: gcc
env: [CMAKE_BUILD_TYPE=Debug, CMAKE_BUILD_TYPE=Release]
    
branches:
  except:
    - /^dependabot\/.*$/

addons:
  apt:
    update: true
    packages:
      - [libsdl2-dev libglew-dev liblzo2-dev libjpeg-dev libopenal-dev libogg-dev libtheora-dev libvorbis-dev]

jobs:
  include:
    - os: freebsd
      addons:
        pkg: [sdl2, glew, lzo2, jpeg-turbo, openal-soft, libogg, libtheora, libvorbis]
    
before_script:
  - git submodule deinit Externals/cryptopp
  #- if [ $TRAVIS_OS_NAME == freebsd ]; then
  #
  #  fi
  - CFLAGS="-w" CXXFLAGS="-w" cmake -B build -DCMAKE_UNITY_BUILD=ON -DCMAKE_BUILD_PARALLEL_LEVEL=2

script:
- cmake --build build
- if [ $TRAVIS_OS_NAME == linux ]; then
      make -j $core_count package;
      file openxray_1.6.02_*.deb;
  fi

#deploy:
#  provider: releases
#  token:
#    secure: kGVniXDR926BfVcA97y25BzALbijvgboBsozZzY9yc8RPz15Q4YG474h7vl14/J1
#  file: ./*.deb
#  draft: true
