language: cpp
cache: ccache

branches:
  except:
    - /^dependabot\/.*$/

os: linux	
dist: focal
virt: lxd
group: edge

arch:
  - arm64-graviton2
  - ppc64le
  - s390x

compiler:
  - gcc
  - clang
  
env:
  - CMAKE_BUILD_TYPE: Debug
    CMAKE_UNITY_BUILD: ON
    CMAKE_BUILD_PARALLEL_LEVEL: 2
  - CMAKE_BUILD_TYPE: Release
    CMAKE_UNITY_BUILD: ON
    CMAKE_BUILD_PARALLEL_LEVEL: 2

before_script:
  - if [ $TRAVIS_OS_NAME == linux ]; then
      sudo apt-get update;
      sudo apt-get install -yq libsdl2-dev libglew-dev liblzo2-dev libjpeg-dev libopenal-dev libogg-dev libtheora-dev libvorbis-dev;
    fi
  - git submodule deinit Externals/cryptopp
  - CFLAGS="-w" CXXFLAGS="-w" cmake -B build

script:
- cmake --build build
- if [ $TRAVIS_OS_NAME == linux ]; then
      make -j $core_count package;
      file openxray_1.6.02_*.deb;
  fi

deploy:
  provider: releases
  token:
    secure: kGVniXDR926BfVcA97y25BzALbijvgboBsozZzY9yc8RPz15Q4YG474h7vl14/J1
  file: ./*.deb
  draft: true
